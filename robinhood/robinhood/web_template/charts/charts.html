<h2>Checkin trend</h2>

<div id="chart"></div>
<script type="text/javascript">
    var city = ''
    if (window.location.pathname.includes('city')) {
        city = window.location.pathname.split('/')[2]
    }

    frappe.call({
        method: "robinhood.robinhood.doctype.checkin.checkin.checkins",
        freeze: true,
        type: 'get',
        args: {
            "city": city
        },
        callback: function(r) {
            if (r) {
                const data = {
                    labels: r.message['labels'],
                    datasets: [{
                        name: "Checkins",
                        type: "bar",
                        values: r.message['values']
                    }, ]
                }

                const chart = new Chart.Chart("#chart", { // or a DOM element,
                    // new Chart() in case of ES6 module with above usage
                    title: "Checkins for last 30days",
                    data: data,
                    type: 'bar', // or 'bar', 'line', 'scatter', 'pie', 'percentage'
                    height: 250,
                    colors: ['#7cd6fd', '#743ee2']
                })
            }
        }
    });


// let data1 = {
//     dataPoints: {
//         "1426744959": 20,
//         "1463673055": 113,
//         "1476892421": 57,
//         // ...
//     },
//     start: new Date("2016-01-01"), // a JS date object
//     end: new Date("2016-12-01")
// }

// let chart1 = new Chart.Chart("#heatmap", {
//     type: 'heatmap',
//     data: data1,
// })



// if (window.location.pathname.includes("chapter")) {
//   fetch(
//     "/api/method/robinhood.robinhood.chapter.chapter.fetch_chapter_checkins"
//   )
//     .then((r) => r.json())
//     .then((r) => {
//       if (r.message) {
//         let labels = r.message.map((item) => item.parent_chapter);
//         let checkin_counts = r.message.map((item) => item.checkin_count);
//         const data = {
//           labels: labels,
//           datasets: [
//             {
//               name: "Checkin Count",
//               type: "bar",
//               values: checkin_counts,
//             },
//           ],
//         };

//         const chart = new frappe.Chart("#chart", {
//           title: "Chapters",
//           data: data,
//           type: "bar",
//           height: 250,
//           colors: ["#7cd6fd", "#743ee2"],
//         });
//       }
//     });
// } else {
//   //  Home page
//   fetch(
//     "/api/method/robinhood.robinhood.chapter.chapter.fetch_top_chapter_checkins"
//   )
//     .then((r) => r.json())
//     .then((r) => {
//       if (r.message) {
//         let labels = r.message.map((item) => item.parent_chapter);
//         let checkin_counts = r.message.map((item) => item.checkin_count);
//         labels.sort().reverse();
//         checkin_counts.sort().reverse();
//         const data = {
//           labels: labels,
//           datasets: [
//             {
//               name: "Checkin Count",
//               type: "bar",
//               values: checkin_counts,
//             },
//           ],
//         };
//         console.log("-----------------", data)
//         const chart = new frappe.Chart("#chart", {
//           title: "Top Chapters of the week",
//           data: data,
//           type: "bar",
//           height: 250,
//           colors: ["#743ee2"],
//         });
//       }
//     });
// }
</script>